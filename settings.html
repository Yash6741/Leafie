√ü<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Leafie ‚Äî Settings</title>
  <style>
    :root{
      --bg: #f3fbf3;
      --panel: #ffffff;
      --muted: #dff0e6;
      --accent: #2e7d32;
      --green: #66bb6a;
      --dark: #0f1720;
      --shadow: 0 4px 10px rgba(30,80,50,0.06);
    }
    html,body{height:100%;}
    body{margin:0; font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:var(--bg); color:var(--dark); display:flex;}

    .sidebar{width:220px; background:#eaf6ea; padding:28px 20px; box-shadow: inset -1px 0 0 rgba(0,0,0,0.03); display:flex; flex-direction:column; gap:18px;}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700; color:var(--green);}
    .nav{ margin-top:12px; display:flex; flex-direction:column; gap:12px; }
    .nav a{ color:#2f4a50; text-decoration:none; padding:10px 8px; border-radius:8px; display:flex; gap:10px; align-items:center; }
    .nav a.active{ background:rgba(0,0,0,0.03); }
    .footer-note{ margin-top:auto; font-size:13px; color:#2f6b5b; }

    main{flex:1; padding:28px;}
    .page-title{ font-size:28px; font-weight:800; margin-bottom:18px; }

    .row{ display:grid; grid-template-columns: 1fr 1fr; gap:18px; align-items:start; }
    .card{ background:var(--panel); border-radius:10px; padding:20px; box-shadow:var(--shadow); border:1px solid rgba(28,90,48,0.06); }
    .card h3{ margin:0 0 8px 0; font-size:20px; }
    .muted{ color:#2b6b8a; margin-bottom:12px; }

    .form-group{ margin:12px 0; }
    label{ display:block; font-size:14px; margin-bottom:8px; }
    input[type="text"], select{ width:100%; padding:12px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); background:#f6fbf6; }

    /* Toggle */
    .toggle{ display:inline-flex; align-items:center; gap:12px; }
    .switch{ width:50px; height:28px; background:#e6f2e7; border-radius:999px; position:relative; display:inline-block; cursor:pointer; }
    .knob{ width:22px; height:22px; background:white; border-radius:50%; position:absolute; top:3px; left:3px; box-shadow:0 2px 6px rgba(0,0,0,0.12); transition:all .18s ease; }
    .switch.on{ background:var(--green); }
    .switch.on .knob{ left:25px; }

    /* slider */
    .slider-wrap{ margin-top:8px; }
    input[type=range]{ width:100%; height:12px; appearance:none; background:transparent; }
    input[type=range]::-webkit-slider-runnable-track{ height:10px; background:#e9f4e9; border-radius:999px; }
    input[type=range]::-webkit-slider-thumb{ appearance:none; margin-top:-6px; width:20px; height:20px; border-radius:50%; background:var(--green); border:6px solid #e9f4e9; box-shadow:0 2px 6px rgba(0,0,0,0.12); }

    .small{ font-size:13px; color:#2b6b8a; }

    @media (max-width:1000px){ .row{ grid-template-columns: 1fr; } .sidebar{display:none;} }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="brand">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 12C6 7 9 4 12 4s6 3 6 8c0 5-6 9-6 9S6 17 6 12z" stroke="#66bb6a" stroke-width="1.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Leafie
    </div>
    <nav class="nav">
      <a href="leafy.html">üè† Dashboard</a>
      <a href="#">üå± Plants</a>
      <a class="active" href="settings.html">‚öôÔ∏è Settings</a>
    </nav>
    <div class="footer-note">Happy Planting!</div>
  </aside>

  <main>
    <div class="page-title">Settings</div>
    <div class="row">
      <div class="card">
        <h3>Plant Profile</h3>
        <div class="muted">Personalize the details for your currently selected plant.</div>
        <div class="form-group">
          <label for="plantName">Plant Name</label>
          <input id="plantName" type="text" placeholder="My Fiddle Leaf">
        </div>
        <div class="form-group">
          <label for="plantType">Plant Type</label>
          <select id="plantType">
            <option value="fiddle">Fiddle Leaf Plant</option>
            <option value="Hole plant">Hole Plant</option>
            <option value="Peace Lily">Peace Lily</option>
            <option value="Gold Palm">Gold Palm</option>
        </select>
        </div>
      </div>

      <div class="card">
        <h3>Watering Settings</h3>
        <div class="muted">Adjust settings for your 'My Fiddle Leaf'.</div>

        <div class="form-group">
          <label>Automatic Watering</label>
          <div class="small">Automatically water when moisture drops below threshold.</div>
          <div style="margin-top:10px; display:flex; justify-content:flex-end;">
            <div class="toggle">
              <div id="autoSwitch" class="switch" role="switch" aria-checked="false"><div class="knob"></div></div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div id="defaultThresholdGroup">
            <label>Moisture Threshold: <span id="thresholdLabel">40%</span></label>
            <div class="small">Set the soil moisture level that triggers automatic watering.</div>
            <div class="slider-wrap">
              <input id="threshold" type="range" min="0" max="100" value="40">
            </div>
          </div>

          <div id="selectedPlantsControlsWrap" style="display:none;">
            <label>Selected Plants Moisture</label>
            <div class="small">Adjust moisture threshold per selected plant.</div>
            <div id="selectedPlantsControls" style="margin-top:10px; display:flex; flex-direction:column; gap:12px;"></div>
          </div>
        </div>

      </div>
    </div>
  </main>

  <script>
    // Local state and persistence
    const plantNameEl = document.getElementById('plantName');
    const plantTypeEl = document.getElementById('plantType');
    const autoSwitch = document.getElementById('autoSwitch');
    const thresholdEl = document.getElementById('threshold');
    const thresholdLabel = document.getElementById('thresholdLabel');
    const selectedPlantsControlsWrap = document.getElementById('selectedPlantsControlsWrap');
    const selectedPlantsControls = document.getElementById('selectedPlantsControls');
    const defaultThresholdGroup = document.getElementById('defaultThresholdGroup');

    function loadSettings(){
      const s = JSON.parse(localStorage.getItem('leafie.settings')||'{}');
      plantNameEl.value = s.name || 'My Fiddle Leaf';
      plantTypeEl.value = s.type || 'fiddle';
      const auto = !!s.auto;
      setSwitch(auto);

      // If other parts of the app expose selected plants, show per-plant controls.
      renderSelectedPlantsControls();

      // If no selected plants, fall back to the global threshold stored in settings
      if(!hasSelectedPlants()){
        thresholdEl.value = (s.threshold!=null? s.threshold: 40);
        thresholdLabel.textContent = thresholdEl.value + '%';
      }
    }

    function saveSettings(){
      const s = { name:plantNameEl.value, type:plantTypeEl.value, auto: autoSwitch.classList.contains('on'), threshold: parseInt(thresholdEl.value,10) };
      localStorage.setItem('leafie.settings', JSON.stringify(s));
    }

    // Helpers for per-selected-plant thresholds
    function tryParseJSON(v){ try{ return JSON.parse(v); }catch(e){ return null; } }

    function getSelectedPlants(){
      // Support a few possible keys other parts of app might use
      const keys = ['leafie.selectedPlants','leafie.selection','leafie.selected'];
      for(const k of keys){
        const raw = localStorage.getItem(k);
        if(!raw) continue;
        const val = tryParseJSON(raw);
        if(Array.isArray(val)) return val;
      }
      return null;
    }

    function hasSelectedPlants(){
      const s = getSelectedPlants();
      return Array.isArray(s) && s.length>0;
    }

    function getPlantStore(){
      return tryParseJSON(localStorage.getItem('leafie.plants')) || {};
    }

    function savePlantStore(store){
      localStorage.setItem('leafie.plants', JSON.stringify(store));
    }

    function loadPlantThreshold(id){
      const store = getPlantStore();
      return (store[id] && store[id].threshold!=null)? store[id].threshold : null;
    }

    function savePlantThreshold(id, value){
      const store = getPlantStore();
      store[id] = store[id] || {};
      store[id].threshold = parseInt(value,10);
      savePlantStore(store);
    }

    function getPlantNameFromEntry(entry, idx){
      if(!entry) return ('Plant ' + (idx+1));
      if(typeof entry === 'string') return entry;
      if(entry.name) return entry.name;
      if(entry.label) return entry.label;
      if(entry.id) return entry.id;
      return ('Plant ' + (idx+1));
    }

    function renderSelectedPlantsControls(){
      const sel = getSelectedPlants();
      if(!Array.isArray(sel) || sel.length===0){
        // nothing selected: show default threshold group
        selectedPlantsControlsWrap.style.display = 'none';
        defaultThresholdGroup.style.display = '';
        // ensure main threshold reflects settings
        const s = JSON.parse(localStorage.getItem('leafie.settings')||'{}');
        thresholdEl.value = (s.threshold!=null? s.threshold: 40);
        thresholdLabel.textContent = thresholdEl.value + '%';
        return;
      }

      // Show per-plant controls
      selectedPlantsControlsWrap.style.display = '';
      defaultThresholdGroup.style.display = 'none';
      selectedPlantsControls.innerHTML = '';

      sel.forEach((entry, idx)=>{
        const id = (typeof entry === 'string')? entry : (entry.id || ('selected-'+idx));
        const name = getPlantNameFromEntry(entry, idx);
        const existingVal = loadPlantThreshold(id);

        const row = document.createElement('div');
        row.style.display = 'flex';
        row.style.flexDirection = 'column';
        row.style.border = '1px solid rgba(0,0,0,0.04)';
        row.style.padding = '8px';
        row.style.borderRadius = '8px';

        const label = document.createElement('label');
        label.textContent = name + ' ('+id+')';
        label.style.fontWeight = '600';
        label.style.marginBottom = '6px';

        const sub = document.createElement('div');
        sub.className = 'small';
        sub.textContent = 'Set moisture threshold for this plant.';

        const sliderWrap = document.createElement('div');
        sliderWrap.className = 'slider-wrap';
        sliderWrap.style.marginTop = '8px';

        const slider = document.createElement('input');
        slider.type = 'range';
        slider.min = 0;
        slider.max = 100;
        slider.value = (existingVal!=null? existingVal: 40);
        slider.dataset.plantId = id;

        const pct = document.createElement('div');
        pct.textContent = slider.value + '%';
        pct.style.marginTop = '6px';
        pct.className = 'small';

        slider.addEventListener('input', ()=>{
          pct.textContent = slider.value + '%';
        });
        slider.addEventListener('change', ()=>{
          savePlantThreshold(id, slider.value);
        });

        sliderWrap.appendChild(slider);
        row.appendChild(label);
        row.appendChild(sub);
        row.appendChild(sliderWrap);
        row.appendChild(pct);

        selectedPlantsControls.appendChild(row);
      });
    }

    // Re-render when selection or plant store changes in other tabs
    window.addEventListener('storage', (e)=>{
      if(!e) return;
      if(e.key && (e.key.startsWith('leafie.selected') || e.key==='leafie.plants')){
        renderSelectedPlantsControls();
      }
    });

    function setSwitch(on){
      if(on){ autoSwitch.classList.add('on'); autoSwitch.setAttribute('aria-checked','true'); } else { autoSwitch.classList.remove('on'); autoSwitch.setAttribute('aria-checked','false'); }
    }

    autoSwitch.addEventListener('click', ()=>{ autoSwitch.classList.toggle('on'); saveSettings(); });
    thresholdEl.addEventListener('input', ()=>{ thresholdLabel.textContent = thresholdEl.value + '%'; saveSettings(); });
    plantNameEl.addEventListener('change', saveSettings);
    plantTypeEl.addEventListener('change', saveSettings);

    loadSettings();
  </script>
</body>
</html>
