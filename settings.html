<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Leafie ‚Äî Settings</title>

<style>
:root{
  --bg:#f3fbf3;
  --panel:#ffffff;
  --accent:#2e7d32;
  --green:#66bb6a;
  --dark:#0f1720;
  --shadow:0 4px 10px rgba(30,80,50,0.06);
}
body{
  margin:0;
  font-family:Inter,system-ui;
  background:var(--bg);
  display:flex;
}
.sidebar{
  width:220px;
  background:#eaf6ea;
  padding:28px 20px;
}
.nav a{
  display:block;
  padding:8px;
  text-decoration:none;
  color:#2f4a50;
}
main{flex:1;padding:28px;}
.card{
  background:var(--panel);
  padding:20px;
  border-radius:10px;
  box-shadow:var(--shadow);
  margin-bottom:20px;
}
.big-btn{
  padding:12px 18px;
  border:none;
  border-radius:8px;
  background:var(--green);
  color:white;
  font-weight:600;
  cursor:pointer;
}
.big-btn:disabled{background:#bbb;}
.muted{color:#2b6b8a;}
</style>
</head>

<body>
<aside class="sidebar">
  <strong style="color:var(--green)">Leafie</strong>
  <nav class="nav">
    <a href="leafy.html">üè† Dashboard</a>
    <a href="settings.html">‚öôÔ∏è Settings</a>
  </nav>
</aside>

<main>
  <h1>Settings</h1>

  <!-- BLE CONNECTION -->
  <div class="card">
    <h3>Device Connection</h3>
    <div id="connStatus" class="muted">Disconnected</div>
    <button id="connectBtn" class="big-btn">üì° Connect via Bluetooth</button>
  </div>

  <!-- PLANT SETTINGS -->
  <div class="card">
    <h3>Plant Profile</h3>
    <select id="plantType">
      <option>Gold Palm</option>
      <option>Hole Plant</option>
      <option>Peace Lily</option>
      <option>Fiddle Leaf</option>
    </select>
  </div>
</main>

<script>
let device, server, service, rxChar;

const SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
const RX_UUID = '6e400002-b5a3-f393-e0a9-e50e24dcca9e';
const TX_UUID = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';

const connectBtn = document.getElementById('connectBtn');
const connStatus = document.getElementById('connStatus');

connectBtn.onclick = async () => {
  try{
    connStatus.textContent = 'Searching for micro:bit...';

    device = await navigator.bluetooth.requestDevice({
      filters:[{namePrefix:'BBC micro:bit'}],
      optionalServices:[SERVICE_UUID]
    });

    connStatus.textContent = 'Connecting...';
    server = await device.gatt.connect();

    device.addEventListener('gattserverdisconnected', ()=>{
      connStatus.textContent = 'Disconnected';
      connectBtn.disabled = false;
      connectBtn.textContent = 'üì° Connect via Bluetooth';
    });

    service = await server.getPrimaryService(SERVICE_UUID);
    rxChar = await service.getCharacteristic(RX_UUID);

    // Listen for data
    try{
      const txChar = await service.getCharacteristic(TX_UUID);
      await txChar.startNotifications();
      txChar.addEventListener('characteristicvaluechanged', e=>{
        const data = new TextDecoder().decode(e.target.value);
        console.log('BLE:', data);
      });
    }catch{}

    connStatus.textContent = 'Connected via BLE';
    connectBtn.textContent = 'Connected';
    connectBtn.disabled = true;

  }catch(err){
    console.error(err);
    connStatus.textContent = 'Connection failed';
  }
};
</script>
</body>
</html>
