<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Leafie ‚Äî Settings</title>
  <style>
    :root{
      --bg:#f3fbf3;
      --panel:#ffffff;
      --accent:#2e7d32;
      --green:#66bb6a;
      --dark:#0f1720;
      --shadow:0 4px 10px rgba(30,80,50,0.06);
    }
    html,body{height:100%;}
    body{margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:var(--bg);color:var(--dark);display:flex;}

    .sidebar{width:220px;background:#eaf6ea;padding:28px 20px;display:flex;flex-direction:column;gap:18px;}
    .brand{font-weight:700;color:var(--green);}
    .nav{margin-top:12px;display:flex;flex-direction:column;gap:12px;}
    .nav a{color:#2f4a50;text-decoration:none;padding:10px 8px;border-radius:8px;}
    .nav a.active{background:rgba(0,0,0,0.05);}
    .footer-note{margin-top:auto;font-size:13px;color:#2f6b5b;}

    main{flex:1;padding:28px;}
    .page-title{font-size:28px;font-weight:800;margin-bottom:18px;}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:18px;}
    .card{background:var(--panel);border-radius:10px;padding:20px;box-shadow:var(--shadow);}
    .card h3{margin:0 0 8px 0;font-size:20px;}
    .muted{color:#2b6b8a;margin-bottom:12px;}

    .form-group{margin:12px 0;}
    label{display:block;font-size:14px;margin-bottom:8px;}
    select{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:#f6fbf6;}

    .switch{width:50px;height:28px;background:#e6f2e7;border-radius:999px;position:relative;cursor:pointer;}
    .knob{width:22px;height:22px;background:white;border-radius:50%;position:absolute;top:3px;left:3px;transition:.18s;}
    .switch.on{background:var(--green);}
    .switch.on .knob{left:25px;}

    input[type=range]{width:100%;appearance:none;background:transparent;}
    input[type=range]::-webkit-slider-runnable-track{height:10px;background:#e9f4e9;border-radius:999px;}
    input[type=range]::-webkit-slider-thumb{appearance:none;margin-top:-6px;width:20px;height:20px;border-radius:50%;background:var(--green);border:6px solid #e9f4e9;}

    button{padding:12px;border-radius:8px;border:none;background:var(--green);color:white;font-weight:600;cursor:pointer;width:100%;margin-top:10px;}

    @media(max-width:1000px){
      .row{grid-template-columns:1fr;}
      .sidebar{display:none;}
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="brand">Leafie</div>
    <nav class="nav">
      <a href="leafy.html">üè† Dashboard</a>
      <a href="#">üå± Plants</a>
      <a class="active" href="settings.html">‚öôÔ∏è Settings</a>
    </nav>
    <div class="footer-note">Happy Planting!</div>
  </aside>

  <main>
    <div class="page-title">Settings</div>
    <div class="row">
      <div class="card">
        <h3>Plant Profile</h3>
        <div class="form-group">
          <label for="plantType">Plant Type</label>
          <select id="plantType">
            <option value="Gold Palm">Gold Palm</option>
            <option value="Hole Plant">Hole Plant</option>
            <option value="Peace Lily">Peace Lily</option>
            <option value="Fiddle Leaf">Fiddle Leaf Plant</option>
          </select>
        </div>
      </div>

      <div class="card">
        <h3>Watering Settings</h3>

        <div class="form-group">
          <label>Automatic Watering</label>
          <div style="display:flex;justify-content:flex-end;">
            <div id="autoSwitch" class="switch">
              <div class="knob"></div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Moisture Threshold: <span id="thresholdLabel">50%</span></label>
          <input id="threshold" type="range" min="0" max="100">
        </div>

        <button id="connectBtn">Connect micro:bit</button>
        <button id="sendBtn">Send Threshold</button>
      </div>
    </div>
  </main>

  <script>
    const plantTypeEl = document.getElementById('plantType');
    const thresholdEl = document.getElementById('threshold');
    const thresholdLabel = document.getElementById('thresholdLabel');
    const autoSwitch = document.getElementById('autoSwitch');
    const connectBtn = document.getElementById('connectBtn');
    const sendBtn = document.getElementById('sendBtn');

    const PLANT_THRESHOLDS = {
      "Gold Palm":60,
      "Hole Plant":40,
      "Peace Lily":60,
      "Fiddle Leaf":50
    };

    const SERVICE_UUID = "6e400001-b5a3-f393-e0a9-e50e24dcca9e";
    const TX_UUID = "6e400002-b5a3-f393-e0a9-e50e24dcca9e";
    let txChar = null;

    function setSwitch(on){
      autoSwitch.classList.toggle('on',on);
    }

    function loadSettings(){
      const s = JSON.parse(localStorage.getItem('leafie.settings')||'{}');
      plantTypeEl.value = s.type || "Fiddle Leaf";
      setSwitch(!!s.auto);
      const t = s.threshold ?? PLANT_THRESHOLDS[plantTypeEl.value];
      thresholdEl.value = t;
      thresholdLabel.textContent = t + "%";
    }

    function saveSettings(){
      localStorage.setItem('leafie.settings',JSON.stringify({
        type:plantTypeEl.value,
        auto:autoSwitch.classList.contains('on'),
        threshold:parseInt(thresholdEl.value,10)
      }));
    }

    plantTypeEl.onchange = ()=>{
      const t = PLANT_THRESHOLDS[plantTypeEl.value];
      thresholdEl.value = t;
      thresholdLabel.textContent = t + "%";
      saveSettings();
    };

    thresholdEl.oninput = ()=>{
      thresholdLabel.textContent = thresholdEl.value + "%";
    };

    thresholdEl.onchange = saveSettings;

    autoSwitch.onclick = ()=>{
      autoSwitch.classList.toggle('on');
      saveSettings();
    };

    connectBtn.onclick = async ()=>{
      const device = await navigator.bluetooth.requestDevice({
        filters:[{namePrefix:"BBC micro:bit"}],
        optionalServices:[SERVICE_UUID]
      });
      const server = await device.gatt.connect();
      const service = await server.getPrimaryService(SERVICE_UUID);
      txChar = await service.getCharacteristic(TX_UUID);
      alert("Connected");
    };

    sendBtn.onclick = async ()=>{
      if(!txChar) return;
      const value = thresholdEl.value + "\n";
      await txChar.writeValue(new TextEncoder().encode(value));
    };

    loadSettings();
  </script>
</body>
</html>
