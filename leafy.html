<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Leafie Dashboard</title>

<style>
:root{
  --bg:#f3fbf3; --panel:#fff; --muted:#dff0e6;
  --accent:#2e7d32; --green:#66bb6a; --dark:#0f1720;
  --shadow:0 4px 10px rgba(30,80,50,.06);
}
body{
  margin:0; font-family:Inter,system-ui;
  background:var(--bg); color:var(--dark);
  display:flex; min-height:100vh;
}
.sidebar{
  width:220px; background:#eaf6ea; padding:28px 20px;
  display:flex; flex-direction:column; gap:18px;
}
.brand{font-weight:800;color:var(--green);display:flex;gap:8px}
.nav a{
  text-decoration:none; color:#2f4a50;
  padding:8px; border-radius:8px;
}
.nav a:hover{background:rgba(0,0,0,.04)}
.main{flex:1;padding:28px}
.grid{display:grid;grid-template-columns:360px 1fr;gap:18px}
.card{
  background:var(--panel); border-radius:10px;
  padding:18px; box-shadow:var(--shadow);
}
.big-btn{
  padding:12px 18px; border:none; border-radius:8px;
  background:var(--green); color:#fff; font-weight:700;
  cursor:pointer;
}
.big-btn:disabled{background:#ccc}
.bar{height:28px;background:var(--muted);border-radius:14px;overflow:hidden}
.bar-fill{
  height:100%; width:0%;
  background:linear-gradient(90deg,var(--green),#4aa85a);
  transition:.4s;
}
.bar-label{
  margin-top:-28px; height:28px;
  display:flex; align-items:center; justify-content:center;
  font-weight:700;
}
.plant-card{
  display:flex; gap:14px; align-items:center;
  border:1px solid rgba(0,0,0,.05);
  padding:12px; border-radius:8px;
}
.plant-card img{
  width:96px;height:72px;object-fit:cover;border-radius:6px;
}
@media(max-width:900px){
  .sidebar{display:none}
  .grid{grid-template-columns:1fr}
}
</style>
</head>

<body>

<aside class="sidebar">
  <div class="brand">ðŸŒ± Leafie</div>
  <nav class="nav">
    <a href="leafy.html">Dashboard</a>
    <a href="plants.html">Plants</a>
    <a href="settings.html">Settings</a>
  </nav>
</aside>

<main class="main">
<h1>Dashboard</h1>

<div class="grid">

<!-- CONNECTION -->
<div class="card">
<h3>Connection</h3>
<div id="connStatus">Disconnected</div>
<button id="connectBtn" class="big-btn">Connect</button>
</div>

<!-- ACTIVE PLANTS -->
<div class="card">
<h3>Active Plants</h3>
<div id="plantArea">Loadingâ€¦</div>
</div>

<!-- RESERVOIR -->
<div class="card" style="grid-column:1/-1">
<h3>Water Reservoir</h3>
<div class="bar">
  <div id="barFill" class="bar-fill"></div>
</div>
<div id="barLabel" class="bar-label">N/A</div>
</div>

</div>
</main>

<script>
/* ===============================
   IMAGE CONSTANTS
================================ */
const IMAGES = {
  peaceLily:
    "https://www.thespruce.com/thmb/XZ3F8w4sS-1JjAfzj8t7w2y0mE4=/1500x0/filters:no_upscale():strip_icc()/peace-lily-care-guide-1902753-hero-7f61b4f46e0d4d5f9f91c5b3b4e9d78c.jpg",
  pothos:
    "https://www.thespruce.com/thmb/2cZ6s5YQ6vU3pP2o6c3k9kY1ZgU=/1500x0/filters:no_upscale():strip_icc()/pothos-care-guide-1902779-hero-7c0c8a2c9f5a4e4b9c7b0f4f3e6a1c2d.jpg"
};

/* ===============================
   MOISTURE UI
================================ */
const barFill=document.getElementById("barFill");
const barLabel=document.getElementById("barLabel");
function setMoisture(p){
  if(isNaN(p)){barFill.style.width="0%";barLabel.textContent="N/A";return;}
  p=Math.max(0,Math.min(100,Math.round(p)));
  barFill.style.width=p+"%"; barLabel.textContent=p+"%";
}

/* ===============================
   PLANT RENDERING
================================ */
function renderPlants(){
  const wrap=document.getElementById("plantArea");
  const plants=JSON.parse(localStorage.getItem("leafie.plants")||"[]");

  if(!plants.length){
    wrap.innerHTML="<p>No active plants</p>";
    return;
  }

  plants.forEach(p=>{
    const name=(p.name||"").toLowerCase();

    if(!p.img){
      if(/peace.*lily|spathiphyllum/.test(name)) p.img=IMAGES.peaceLily;
      if(/pothos|epipremnum|devil|hole/.test(name)) p.img=IMAGES.pothos;
    }
  });

  localStorage.setItem("leafie.plants",JSON.stringify(plants));

  wrap.innerHTML=plants.map(p=>`
    <div class="plant-card">
      <img src="${p.img||''}">
      <div>
        <strong>${p.name}</strong>
        <div>Your plant companion ðŸŒ¿</div>
      </div>
    </div>
  `).join("");
}

/* ===============================
   CONNECTION (USB + BLE)
================================ */
const connStatus=document.getElementById("connStatus");
const connectBtn=document.getElementById("connectBtn");

connectBtn.onclick=async()=>{
  connStatus.textContent="Connectingâ€¦";
  try{
    if(navigator.usb){
      const devices=await navigator.usb.getDevices();
      if(devices.length){
        connStatus.textContent="Connected (USB)";
        connectBtn.disabled=true;
        return;
      }
    }
    if(navigator.bluetooth){
      const dev=await navigator.bluetooth.requestDevice({acceptAllDevices:true});
      await dev.gatt.connect();
      connStatus.textContent="Connected (Bluetooth)";
      connectBtn.disabled=true;
    }
  }catch{
    connStatus.textContent="Connection failed";
  }
};

/* ===============================
   INIT
================================ */
renderPlants();
</script>

</body>
</html>
